{"dependencies":[{"name":"three","loc":{"line":3,"column":20}},{"name":"./Building","loc":{"line":4,"column":25}},{"name":"./common","loc":{"line":5,"column":23}}],"generated":{"js":"\"use strict\";exports.__esModule=!0;var e=require(\"three\"),t=require(\"./Building\"),i=require(\"./common\"),n=function(){function n(){this.mouse=new e.Vector2,this.hoverObject=null,this.selectedObject=null}return n.prototype.init=function(){var n=this;this.container=document.querySelector(\"#container\")||i.expect(),this.buildingInfoPanel=document.querySelector(\"#buildingInfoPanel\")||i.expect(),this.renderer=new e.WebGLRenderer({antialias:!0,devicePixelRatio:128}),this.renderer.setClearColor(new e.Color(6591981)),this.renderer.setSize(window.innerWidth,window.innerHeight),this.scene=new e.Scene,this.camera=new e.PerspectiveCamera,this.camera.position.set(0,10,5),this.camera.lookAt(new e.Vector3(0,0,0)),this.raycaster=new e.Raycaster,this.mainTarget=new e.WebGLRenderTarget(256,240,{minFilter:e.LinearFilter,magFilter:e.NearestFilter}),this.screenScene=new e.Scene,this.screenScene.add(new e.Mesh(new e.PlaneBufferGeometry(2,2,1,1),new e.MeshBasicMaterial({map:this.mainTarget.texture}))),this.screenCamera=new e.OrthographicCamera(-1,1,1,-1),this.screenCamera.position.setZ(100),this.screenCamera.lookAt(new e.Vector3(0,0,0));for(var r=-10,s=-10,o=-8;o<8;o++){s=-10;for(var a=-8;a<8;a++){var c=4*Math.random();e.Math.clamp(c,1,4);var h=new t.Building(c);h.position.setX(r),h.position.setZ(s),this.scene.add(h),(s+=1)%4==0&&(s+=1)}(r+=1)%6==0&&(r+=1)}var d=new e.Mesh(new e.PlaneGeometry(100,100),new e.MeshLambertMaterial({color:1052688}));d.position.setX(-10),d.position.setZ(-10),d.rotateX(e.Math.degToRad(-90)),this.scene.add(d);var l=new e.AmbientLight(15395562);this.scene.add(l);var u=new e.DirectionalLight(15395562);u.lookAt(new e.Vector3(0,0,0)),u.position.set(20,20,-20),this.scene.add(u),this.container.appendChild(this.renderer.domElement),document.body.addEventListener(\"keypress\",function(e){n.onKeyPress(e)}),window.addEventListener(\"resize\",function(e){n.onResize()}),this.container.addEventListener(\"mousemove\",function(e){n.onMouseMove(e)}),this.container.addEventListener(\"click\",function(e){n.onMouseClick()}),this.onResize(),this.update()},n.prototype.update=function(e){this.raycaster.setFromCamera(this.mouse,this.camera);var i=this.raycaster.intersectObjects(this.scene.children);if(i.length>0){i.sort(function(e,t){return e.distance-t.distance});var n=i[0].object;n instanceof t.Building?this.onHoverBuilding(n):(this.hoverObject&&this.hoverObject.state===t.BuildingHoverState.Hovered&&this.hoverObject.changeState(t.BuildingHoverState.Deselected),this.hoverObject=null)}this.renderer.render(this.scene,this.camera,this.mainTarget,!0),this.renderer.render(this.screenScene,this.screenCamera),requestAnimationFrame(this.update.bind(this))},n.prototype.onKeyPress=function(t){\"w\"===t.key?this.camera.position.add(new e.Vector3(0,0,-1)):\"s\"===t.key?this.camera.position.add(new e.Vector3(0,0,1)):\"a\"===t.key?this.camera.position.add(new e.Vector3(-1,0,0)):\"d\"===t.key&&this.camera.position.add(new e.Vector3(1,0,0))},n.prototype.onResize=function(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()},n.prototype.onMouseMove=function(e){this.mouse.x=e.clientX/window.innerWidth*2-1,this.mouse.y=-e.clientY/window.innerHeight*2+1},n.prototype.onMouseClick=function(){this.hoverObject&&(this.selectedObject&&this.selectedObject.changeState(t.BuildingHoverState.Deselected),this.selectedObject=this.hoverObject,this.selectedObject.changeState(t.BuildingHoverState.Selected),this.buildingInfoPanel.innerText=\"=== BUILDING INFO PANEL ===\\nBLDID     = \"+this.selectedObject.getBuildingId()+\"\\nCONNECT   = \"+(this.selectedObject.getBuildingConnected()?\"TRUE\":\"FALSE\")+\"\\nBANDWIDTH = \"+this.selectedObject.getBuildingBandwidth())},n.prototype.onHoverBuilding=function(e){e!=this.hoverObject&&e!=this.selectedObject&&(this.hoverObject&&this.hoverObject.state===t.BuildingHoverState.Hovered&&this.hoverObject.changeState(t.BuildingHoverState.Deselected),e.changeState(t.BuildingHoverState.Hovered),this.hoverObject=e)},n}();document.addEventListener(\"DOMContentLoaded\",function(){(new n).init()});"},"hash":"352085f9a93de36d3ea2b8536b027492"}